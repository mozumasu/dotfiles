snippets:
  - name: git status
    keyword: gs
    snippet: git status --short --branch

  # snippet with placeholder
  - name: git commit message
    keyword: gcim
    snippet: git commit -m '{{commit_message}}'

  - keyword: proot
    snippet: cd $(git rev-parse --show-toplevel)

  - name: branch
    keyword: B
    snippet: git symbolic-ref --short HEAD
    context:
      lbuffer: '^git\s+checkout\s+'
    evaluate: true # eval snippet

  - keyword: proot
    snippet: 'cd $(git rev-parse --show-toplevel)'

  - keyword: ghc
    snippet: gh repo create '{{repo_name}}' --private

  - name: gh pr create
    keyword: ghpr
    snippet:
      gh pr create --title "{{title}}" --body "$(cat <<'EOF'
      {{content}}
      EOF)"

  - keyword: g
    snippet: git

  - keyword: gs
    snippet: git status

  - keyword: gsw
    snippet: git switch

  - keyword: gpl
    snippet: git pull

  - keyword: gfe
    snippet: git fetch

  - keyword: lg
    snippet: lazygit

  - keyword: gln
    snippet: git log {{branch}}..HEAD --name-only

  - keyword: gds
    snippet: git diff --stat {{branch}}..HEAD

  # GitHub Projects-related snippets
  - keyword: ghp
    snippet: gh project view {{number}} --owner {{owner}} --web

  - keyword: ghpi
    snippet: gh project item-list {{number}} --owner {{owner}}

  - keyword: ghpv
    snippet: gh project view {{number}} --owner {{owner}}

completions:
  - name: gh browse
    patterns:
      - "^gh browse -R( .*)? $"
    sourceCommand: "gh repo list --visibility=public | awk '{print $1}'"
    options:
      --prompt: "'browse repo >'"

  - name: ghq get
    patterns:
      - "^ghqg"
      - "^ghq get( .*)? $"
    sourceCommand: "gh api user/repos --paginate -q '.[].full_name'"
    options:
      --prompt: "'ghq get > '"
      --preview: "gh repo view {}"
    callback: "ghq get ${1}"

  - name: gh run ID
    patterns:
      - "^gh run (watch|view|cancel|download|rerun)( .*)? $"
    sourceCommand: gh run list --limit 20 --json databaseId,status,conclusion,displayTitle,workflowName | jq -r '.[] | "\(.databaseId)\t[\(if .status != "completed" then "⚡" elif .conclusion == "success" then "✓" elif .conclusion == "failure" then "✗" else "⚠" end)] \(.displayTitle) (\(.workflowName))"'
    options:
      --prompt: "'Run ID> '"
      --preview: "echo {} | cut -f2-"
    callback: "awk '{print $1}'"

  # GitHub Projects Suggestions
  - name: gh project owner option
    patterns:
      - "^gh project (?:view|list|edit|close|delete|item-list|field-list) --owner $"
    sourceCommand: "(echo '@me'; gh org list 2>/dev/null | awk '{print $1}')"
    options:
      --prompt: "'Owner> '"
      --preview: "gh api users/{} 2>/dev/null | jq -r '.name, .bio' || gh api orgs/{} 2>/dev/null | jq -r '.name, .description'"
    callback: "awk '{print $1}'"

  - name: gh project number
    patterns:
      - "^gh project (?:view|edit|close|delete|item-list|field-list)( .*)? $"
    sourceCommand: "OWNER=$(echo \"${LBUFFER}${RBUFFER}\" | perl -ne 'print $1 if /--owner(?:=|\\s+)([A-Za-z0-9._-]+)/'); gh project list --owner ${OWNER:-@me} --limit 1000 --format json 2>/dev/null | jq -r '.projects[] | \"\\(.number)\\t\\(.title)\"'"
    options:
      --prompt: "'Project> '"
      --preview: "OWNER=$(echo \"${LBUFFER}${RBUFFER}\" | perl -ne 'print $1 if /--owner(?:=|\\s+)([A-Za-z0-9._-]+)/'); echo {} | awk '{print $1}' | xargs -I NUM gh project view NUM --owner ${OWNER:-@me} 2>/dev/null"
    callback: "awk '{print $1}'"

snippets:
  - keyword: gc
    snippet: gcloud
    patterns:
      - '^gcloud\b'

  - keyword: ga;
    snippet: gcloud auth application-default login --impersonate-service-account {{SERVICE_ACCOUNT_EMAIL}}

  - keyword: gcl;
    snippet: gcloud config configurations list

  - keyword: gao;
    snippet: gcloud app open-console --project {{PROJECT_ID}}

  - keyword: gaos;
    snippet: gcloud app open-console --project {{PROJECT_ID}} --service {{SERVICE}}

  - keyword: gsva;
    snippet: gcloud secrets versions access latest --project={{PROJECT_ID}} --secret={{SECRET_NAME}}

completions:
  - name: gcloud project
    patterns:
      - '^gcloud\b.*--project(?:=|\s+)[A-Za-z0-9._-]*$'
      - '^gcloud config set project'
    sourceCommand: "gcloud projects list --format='value(projectId)' 2>/dev/null"
    options:
      --prompt: "'GCP Project> '"

  - name: gcloud app service
    patterns:
      - '^gcloud\b.*--service(?:=|\s+)[A-Za-z0-9._-]*$'
    sourceCommand: "PROJECT=$(echo \"${LBUFFER}${RBUFFER}\" | perl -ne 'print $1 if /--project[=\\s]+(\\S+)/'); [ -n \"$PROJECT\" ] && gcloud app services list --format='value(id)' --project=\"$PROJECT\" 2>/dev/null"
    options:
      --prompt: "'App Service> '"

  - name: gcloud secret
    patterns:
      - '^gcloud\b.*--secret(?:=|\s+)[A-Za-z0-9._-]*$'
      - '^gcloud secrets\b.*[^-\s][A-Za-z0-9._-]*$'
    sourceCommand: "PROJECT=$(echo \"${LBUFFER}${RBUFFER}\" | perl -ne 'print $1 if /--project[=\\s]+([A-Za-z0-9][A-Za-z0-9._:-]*)/'); { [ -n \"$PROJECT\" ] && gcloud secrets list --format='value(name)' --project=\"$PROJECT\" 2>/dev/null || gcloud secrets list --format='value(name)' 2>/dev/null; }"
    options:
      --prompt: "'GCP Secret> '"
